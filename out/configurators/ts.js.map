{"version":3,"sources":["../../src/configurators/ts.ts"],"names":[],"mappings":";;;;;;;;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEO,eAAK,mBAAL,CAAmC,YAAnC,EAAoE;AACzE,QAAM,eAAe,aAAa,gBAAb,CAA8B,gCAA9B,KAAmE,aAAa,gBAAb,CAA8B,qBAA9B,CAAxF;;AACA,MAAI,EAAE,gBAAgB,aAAa,gBAAb,CAA8B,WAA9B,CAAlB,CAAJ,EAAmE;AACjE;AACD,GAJwE,CAMzE;;;AACA,eAAa,UAAb,CAAwB,MAAxB,CAA+B,CAA/B,EAAkC,CAAlC,EAAqC,KAArC,EAA4C,MAA5C;AAEA,QAAM,kBAAkB,aAAa,MAAb,IAAwB,gBAAgB,CAAC,aAAa,YAA9E;AAEA,QAAM,eAAe,MAAM,kCAAqB,CAAC,KAAK,IAAL,CAAU,aAAa,SAAvB,EAAkC,eAAlC,CAAD,EAAqD,KAAK,IAAL,CAAU,aAAa,UAAvB,EAAmC,eAAnC,CAArD,CAArB,EAAgI,IAAhI,CAA3B,CAXyE,CAYzE;;AACA,MAAI,gBAAgB,IAApB,EAA0B;AACxB,UAAM,IAAI,KAAJ,CAAU,uCAAuC,aAAa,UAAU,mFAAxE,CAAN;AACD;;AAED,MAAI,aAAa,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,iBAAa,KAAb,CAAmB,SAAS,YAAY,EAAxC;AACD,GAnBwE,CAqBzE;;;AACA,MAAI,mBAAmB,CAAC,aAAa,MAArC,EAA6C;AAC3C,UAAM,6BAA6B,QAAQ,gCAAR,CAAnC;;AACA,iBAAa,OAAb,CAAqB,IAArB,CAA0B,IAAI,0BAAJ,CAA+B;AACvD,gBAAU,YAD6C;AAEvD,cAAQ,aAAa,GAAb,CAAiB,mBAAjB,IAAwC;AAC9C,cAAM,MAAK,CACT;AACD,SAH6C;AAK9C,cAAM,QAAQ,IAAR,CAAa,IAAb,CAAkB,OAAlB,CALwC;AAM9C,eAAO,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB;AANuC;AAFO,KAA/B,CAA1B;AAWD;;AAED,QAAM,kBAAuB;AAC3B;AACA;AACA,mBAAe,eAHY;AAI3B,sBAAkB,CAAC,QAAD,CAJS;AAK3B,gBAAY;AALe,GAA7B;;AAQA,MAAI,aAAa,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,iBAAa,KAAb,CAAmB,sBAAsB,KAAK,SAAL,CAAe,eAAf,EAAgC,IAAhC,EAAsC,CAAtC,CAAwC,EAAjF;AACD;;AAED,eAAa,KAAb,CAAmB,IAAnB,CAAwB;AACtB,UAAM,SADgB;AAEtB,aAAS,cAFa;AAGtB,SAAK,CACH;AACE,cAAQ,WADV;AAEE,eAAS;AAFX,KADG;AAHiB,GAAxB;AAUD,C","sourcesContent":["import * as path from \"path\"\nimport { WebpackConfigurator } from \"../main\"\nimport { getFirstExistingFile } from \"../util\"\n\nexport async function configureTypescript(configurator: WebpackConfigurator) {\n  const hasTsChecker = configurator.hasDevDependency(\"fork-ts-checker-webpack-plugin\") || configurator.hasDevDependency(\"electron-webpack-ts\")\n  if (!(hasTsChecker || configurator.hasDevDependency(\"ts-loader\"))) {\n    return\n  }\n\n  // add after js\n  configurator.extensions.splice(1, 0, \".ts\", \".tsx\")\n\n  const isTranspileOnly = configurator.isTest || (hasTsChecker && !configurator.isProduction)\n\n  const tsConfigFile = await getFirstExistingFile([path.join(configurator.sourceDir, \"tsconfig.json\"), path.join(configurator.projectDir, \"tsconfig.json\")], null)\n  // check to produce clear error message if no tsconfig.json\n  if (tsConfigFile == null) {\n    throw new Error(`Please create tsconfig.json in the \"${configurator.projectDir}\":\\n\\n{\\n  \"extends\": \"./node_modules/electron-webpack/tsconfig-base.json\"\\n}\\n\\n`)\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`Using ${tsConfigFile}`)\n  }\n\n  // no sense to use fork-ts-checker-webpack-plugin for production build\n  if (isTranspileOnly && !configurator.isTest) {\n    const ForkTsCheckerWebpackPlugin = require(\"fork-ts-checker-webpack-plugin\")\n    configurator.plugins.push(new ForkTsCheckerWebpackPlugin({\n      tsconfig: tsConfigFile,\n      logger: configurator.env.forkTsCheckerLogger || {\n        info: () => {\n          // ignore\n        },\n\n        warn: console.warn.bind(console),\n        error: console.error.bind(console),\n      }\n    }))\n  }\n\n  const tsLoaderOptions: any = {\n    // use transpileOnly mode to speed-up compilation\n    // in the test mode also, because checked during dev or production build\n    transpileOnly: isTranspileOnly,\n    appendTsSuffixTo: [/\\.vue$/],\n    configFile: tsConfigFile,\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`ts-loader options: ${JSON.stringify(tsLoaderOptions, null, 2)}`)\n  }\n\n  configurator.rules.push({\n    test: /\\.tsx?$/,\n    exclude: /node_modules/,\n    use: [\n      {\n        loader: \"ts-loader\",\n        options: tsLoaderOptions\n      },\n    ],\n  })\n}"],"sourceRoot":""}
