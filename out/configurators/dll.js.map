{"version":3,"sources":["../../src/configurators/dll.ts"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEO,eAAK,YAAL,CAA4B,YAA5B,EAA6D;AAClE,MAAI,cAA6B,IAAjC;AACA,QAAM,aAAa,aAAa,UAAhC;;AAEA,MAAI,aAAa,IAAb,KAAsB,cAA1B,EAA0C;AACxC,UAAM,MAAM,aAAa,4BAAb,CAA0C,QAA1C,CAAqD,GAAjE;;AACA,QAAI,OAAO,IAAX,EAAiB;AACf,YAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,iBAAa,MAAb,CAAoB,KAApB,GAA4B,MAAM,OAAN,CAAc,GAAd,IAAqB;AAAC,cAAQ;AAAT,KAArB,GAAqC,GAAjE;AAEA,kBAAc,KAAK,IAAL,CAAU,aAAa,mBAAvB,EAA4C,aAAa,IAAzD,EAA+D,eAA/D,CAAd;AACA,iBAAa,OAAb,CAAqB,IAArB,CAA0B,KAAI,oBAAJ,EAAc;AACtC,YAAM,QADgC;AAEtC,YAAM,WAFgC;AAGtC,eAAS;AAH6B,KAAd,CAA1B;AAMA,UAAM,SAAS,aAAa,MAAb,CAAoB,MAAnC,CAfwC,CAgBxC;;AACA,WAAO,OAAO,aAAd;AACA,WAAO,OAAP,GAAiB,QAAjB;AACD,GAnBD,MAoBK,IAAI,aAAa,IAAb,KAAsB,UAA1B,EAAsC;AACzC,UAAM,SAAS,KAAK,IAAL,CAAU,aAAa,mBAAvB,EAA4C,cAA5C,CAAf;AACA,UAAM,UAAU,MAAM,wBAAW,MAAX,CAAtB;;AACA,QAAI,WAAW,IAAX,IAAmB,CAAC,QAAQ,WAAR,EAAxB,EAA+C;AAC7C,mBAAa,KAAb,CAAmB,kBAAnB;AACA,aAAO,IAAP;AACD;;AAED,iBAAa,KAAb,CAAmB,kBAAkB,MAAM,EAA3C;AACA,iBAAa,OAAb,CAAqB,IAArB,CAA0B,KAAI,6BAAJ,EAAuB;AAC/C,eAAS,UADsC;AAE/C,gBAAU,MAAM,0BAAS,KAAK,IAAL,CAAU,MAAV,EAAkB,eAAlB,CAAT;AAF+B,KAAvB,CAA1B;AAID;;AAED,SAAO,WAAP;AACD;;AAEM,eAAK,YAAL,CAA4B,MAA5B,EAA4C,YAA5C,EAA6E;AAClF,MAAI,aAAa,4BAAb,CAA0C,QAA1C,CAAqD,GAArD,IAA4D,IAAhE,EAAsE;AACpE,WAAO,EAAP;AACD;;AAED,QAAM,QAAQ,MAAM,kCAAqB,yBAAQ,MAAR,CAArB,CAApB;AACA,SAAO,SAAS,IAAT,GAAgB,EAAhB,GAAqB,MAAM,MAAN,CAAa,MAAM,GAAG,QAAH,CAAY,KAAZ,KAAsB,GAAG,QAAH,CAAY,MAAZ,CAAzC,EAA8D,IAA9D,EAA5B;AACD,C","sourcesContent":["import { readdir, readJson } from \"fs-extra-p\"\nimport * as path from \"path\"\nimport { DllPlugin, DllReferencePlugin } from \"webpack\"\nimport { WebpackConfigurator } from \"../main\"\nimport { orNullIfFileNotExist, statOrNull } from \"../util\"\n\nexport async function configureDll(configurator: WebpackConfigurator): Promise<string | null> {\n  let dllManifest: string | null = null\n  const projectDir = configurator.projectDir\n\n  if (configurator.type === \"renderer-dll\") {\n    const dll = configurator.electronWebpackConfiguration.renderer!!.dll\n    if (dll == null) {\n      throw new Error(`renderer-dll requires DLL configuration`)\n    }\n\n    configurator.config.entry = Array.isArray(dll) ? {vendor: dll} : dll\n\n    dllManifest = path.join(configurator.commonDistDirectory, configurator.type, \"manifest.json\")\n    configurator.plugins.push(new DllPlugin({\n      name: \"[name]\",\n      path: dllManifest,\n      context: projectDir,\n    }))\n\n    const output = configurator.config.output!\n    // leave as default \"var\"\n    delete output.libraryTarget\n    output.library = \"[name]\"\n  }\n  else if (configurator.type === \"renderer\") {\n    const dllDir = path.join(configurator.commonDistDirectory, \"renderer-dll\")\n    const dirStat = await statOrNull(dllDir)\n    if (dirStat == null || !dirStat.isDirectory()) {\n      configurator.debug(\"No DLL directory\")\n      return null\n    }\n\n    configurator.debug(`DLL directory: ${dllDir}`)\n    configurator.plugins.push(new DllReferencePlugin({\n      context: projectDir,\n      manifest: await readJson(path.join(dllDir, \"manifest.json\")),\n    }))\n  }\n\n  return dllManifest\n}\n\nexport async function getDllAssets(dllDir: string, configurator: WebpackConfigurator) {\n  if (configurator.electronWebpackConfiguration.renderer!!.dll == null) {\n    return []\n  }\n\n  const files = await orNullIfFileNotExist(readdir(dllDir))\n  return files == null ? [] : files.filter(it => it.endsWith(\".js\") || it.endsWith(\".css\")).sort()\n}"],"sourceRoot":""}
